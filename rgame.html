<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TESTING: Alien Ship Infiltration Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }
        
        body {
            background: #0a0a1a;
            color: #e0e0e0;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, rgba(10, 25, 50, 0.9), rgba(5, 15, 35, 0.95));
            border-radius: 12px;
            border: 1px solid rgba(0, 200, 255, 0.3);
        }
        
        h1 {
            color: #18ffff;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 0 10px rgba(24, 255, 255, 0.5);
        }
        
        .subtitle {
            color: #4fc3f7;
            font-size: 1.2em;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .game-section {
            background: rgba(5, 15, 35, 0.9);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(0, 200, 255, 0.3);
        }
        
        .controls-section {
            background: rgba(15, 25, 45, 0.9);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(0, 255, 200, 0.3);
        }
        
        h2 {
            color: #00ffaa;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(0, 255, 170, 0.3);
        }
        
        h3 {
            color: #ffd600;
            margin: 15px 0 10px 0;
        }
        
        #gameContainer {
            width: 100%;
            height: 600px;
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            border: 2px solid #00aaff;
            margin-bottom: 20px;
        }
        
        #gameCanvas {
            width: 100%;
            height: 100%;
            display: block;
        }
        
        .button-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 15px 0;
        }
        
        .test-btn {
            background: linear-gradient(135deg, #0066cc, #004499);
            color: white;
            border: none;
            padding: 12px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            text-align: center;
            transition: all 0.3s;
            border: 1px solid rgba(0, 150, 255, 0.5);
        }
        
        .test-btn:hover {
            background: linear-gradient(135deg, #0088ff, #0066cc);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 136, 255, 0.4);
        }
        
        .test-btn:active {
            transform: translateY(1px);
        }
        
        .danger-btn {
            background: linear-gradient(135deg, #cc3300, #992200);
        }
        
        .danger-btn:hover {
            background: linear-gradient(135deg, #ff4400, #cc3300);
        }
        
        .success-btn {
            background: linear-gradient(135deg, #00cc66, #009944);
        }
        
        .success-btn:hover {
            background: linear-gradient(135deg, #00ff88, #00cc66);
        }
        
        .control-item {
            margin: 10px 0;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .key {
            background: rgba(255, 255, 255, 0.1);
            padding: 4px 10px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            min-width: 40px;
            text-align: center;
        }
        
        .log-section {
            background: rgba(0, 10, 20, 0.9);
            border-radius: 12px;
            padding: 20px;
            margin-top: 30px;
            border: 1px solid rgba(255, 200, 0, 0.3);
        }
        
        #debugLog {
            height: 200px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            margin-top: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .log-entry {
            margin-bottom: 8px;
            padding: 5px;
            border-left: 3px solid #00aaff;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-online {
            background: #00ff00;
            box-shadow: 0 0 10px #00ff00;
        }
        
        .status-offline {
            background: #ff0000;
            box-shadow: 0 0 10px #ff0000;
        }
        
        .system-check {
            margin: 15px 0;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
        }
        
        .check-item {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
        }
        
        .check-pass {
            color: #00ff00;
        }
        
        .check-fail {
            color: #ff3333;
        }
        
        .warning-box {
            background: rgba(255, 153, 0, 0.1);
            border: 1px solid rgba(255, 153, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .info-box {
            background: rgba(0, 153, 255, 0.1);
            border: 1px solid rgba(0, 153, 255, 0.3);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .test-step {
            margin: 10px 0;
            padding-left: 20px;
            position: relative;
        }
        
        .test-step:before {
            content: "â–¶";
            position: absolute;
            left: 0;
            color: #00ffaa;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ALIEN SHIP INFILTRATION GAME - TEST SUITE</h1>
            <div class="subtitle">Complete Testing Environment with Debug Tools</div>
        </header>
        
        <div class="test-grid">
            <div class="game-section">
                <h2>GAME VIEWPORT</h2>
                <div id="gameContainer">
                    <canvas id="gameCanvas"></canvas>
                    <div id="gameOverlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;"></div>
                </div>
                
                <h3>Game Status</h3>
                <div class="button-grid">
                    <button class="test-btn success-btn" onclick="startGameTest()">START GAME</button>
                    <button class="test-btn danger-btn" onclick="resetGameTest()">RESET GAME</button>
                    <button class="test-btn" onclick="simulateCombatTest()">SIMULATE COMBAT</button>
                    <button class="test-btn" onclick="completeLevelTest()">COMPLETE LEVEL</button>
                    <button class="test-btn" onclick="damagePlayerTest()">DAMAGE PLAYER (-20 HP)</button>
                    <button class="test-btn success-btn" onclick="healPlayerTest()">HEAL PLAYER (+30 HP)</button>
                    <button class="test-btn" onclick="toggleStealthTest()">TOGGLE STEALTH</button>
                    <button class="test-btn" onclick="reloadWeaponTest()">RELOAD WEAPON</button>
                </div>
                
                <h3>Performance Monitor</h3>
                <div class="system-check">
                    <div class="check-item">
                        <span>FPS:</span>
                        <span id="fpsCounter" class="check-pass">60</span>
                    </div>
                    <div class="check-item">
                        <span>Memory:</span>
                        <span id="memoryCounter" class="check-pass">Normal</span>
                    </div>
                    <div class="check-item">
                        <span>Render Time:</span>
                        <span id="renderTime" class="check-pass">0ms</span>
                    </div>
                </div>
            </div>
            
            <div class="controls-section">
                <h2>TESTING CONTROLS</h2>
                
                <div class="info-box">
                    <strong>TESTING INSTRUCTIONS:</strong>
                    <div class="test-step">1. Click START GAME to begin</div>
                    <div class="test-step">2. Test controls below</div>
                    <div class="test-step">3. Check Debug Log for results</div>
                    <div class="test-step">4. Use SIMULATE buttons to test features</div>
                </div>
                
                <h3>Keyboard Controls</h3>
                <div class="control-item">
                    <span>Movement:</span>
                    <span class="key">WASD</span>
                </div>
                <div class="control-item">
                    <span>Look Around:</span>
                    <span class="key">MOUSE</span>
                </div>
                <div class="control-item">
                    <span>Fire Weapon:</span>
                    <span class="key">LMB</span>
                </div>
                <div class="control-item">
                    <span>Interact:</span>
                    <span class="key">E</span>
                </div>
                <div class="control-item">
                    <span>Stealth Toggle:</span>
                    <span class="key">SHIFT</span>
                </div>
                <div class="control-item">
                    <span>Jump:</span>
                    <span class="key">SPACE</span>
                </div>
                <div class="control-item">
                    <span>Reload:</span>
                    <span class="key">R</span>
                </div>
                
                <h3>Quick Test Actions</h3>
                <div class="button-grid">
                    <button class="test-btn" onclick="addAlienTest()">ADD ALIEN</button>
                    <button class="test-btn" onclick="removeAlienTest()">REMOVE ALIEN</button>
                    <button class="test-btn" onclick="fireWeaponTest()">FIRE WEAPON</button>
                    <button class="test-btn" onclick="interactTest()">INTERACT (E)</button>
                    <button class="test-btn" onclick="nextLevelTest()">NEXT LEVEL</button>
                    <button class="test-btn danger-btn" onclick="failMissionTest()">FAIL MISSION</button>
                </div>
                
                <div class="warning-box">
                    <strong>Note:</strong> Click on the 3D canvas first to enable mouse controls. Some browsers may require user interaction before audio plays.
                </div>
            </div>
        </div>
        
        <div class="log-section">
            <h2>DEBUG LOG <span id="logCount">(0 entries)</span></h2>
            <div id="debugLog"></div>
            <div style="margin-top: 10px;">
                <button class="test-btn" onclick="clearLog()" style="margin-right: 10px;">CLEAR LOG</button>
                <button class="test-btn" onclick="exportLog()">EXPORT LOG</button>
                <button class="test-btn" onclick="runAllTests()">RUN ALL TESTS</button>
            </div>
        </div>
    </div>

    <!-- Three.js Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <script>
        // ============== TESTING FRAMEWORK ==============
        let debugLog = [];
        let gameInstance = null;
        let frameCount = 0;
        let lastTime = performance.now();
        let fps = 60;
        
        // Log system
        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = {
                time: timestamp,
                message: message,
                type: type
            };
            
            debugLog.push(logEntry);
            
            // Update log display
            const logDiv = document.getElementById('debugLog');
            const entryDiv = document.createElement('div');
            entryDiv.className = 'log-entry';
            entryDiv.style.borderLeftColor = type === 'error' ? '#ff3333' : 
                                            type === 'success' ? '#00ff00' : 
                                            type === 'warning' ? '#ff9900' : '#00aaff';
            entryDiv.innerHTML = `<strong>[${timestamp}]</strong> ${message}`;
            logDiv.appendChild(entryDiv);
            
            // Auto-scroll
            logDiv.scrollTop = logDiv.scrollHeight;
            
            // Update counter
            document.getElementById('logCount').textContent = `(${debugLog.length} entries)`;
            
            // Console output
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        // Clear log
        function clearLog() {
            debugLog = [];
            document.getElementById('debugLog').innerHTML = '';
            document.getElementById('logCount').textContent = '(0 entries)';
            addLog('Debug log cleared', 'info');
        }
        
        // Export log
        function exportLog() {
            const logText = debugLog.map(entry => `[${entry.time}] ${entry.message}`).join('\n');
            const blob = new Blob([logText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `alien_game_test_${new Date().toISOString().slice(0,10)}.log`;
            a.click();
            addLog('Log exported', 'success');
        }
        
        // Run all tests
        function runAllTests() {
            addLog('=== RUNNING COMPREHENSIVE TEST SUITE ===', 'warning');
            
            setTimeout(() => startGameTest(), 500);
            setTimeout(() => simulateCombatTest(), 1500);
            setTimeout(() => interactTest(), 2500);
            setTimeout(() => toggleStealthTest(), 3500);
            setTimeout(() => reloadWeaponTest(), 4500);
            setTimeout(() => completeLevelTest(), 5500);
            
            addLog('All tests scheduled. Check logs for results.', 'success');
        }
        
        // ============== GAME ENGINE (Simplified for Testing) ==============
        class TestGame {
            constructor() {
                this.scene = null;
                this.camera = null;
                this.renderer = null;
                this.gameState = {
                    started: false,
                    level: 1,
                    health: 100,
                    energy: 100,
                    stealth: true,
                    aliens: 12,
                    distance: 245,
                    integrity: 98,
                    ammo: 24,
                    maxAmmo: 24,
                    time: 0
                };
                this.init();
            }
            
            init() {
                addLog('Initializing test game engine...', 'info');
                
                try {
                    // Create scene
                    this.scene = new THREE.Scene();
                    this.scene.background = new THREE.Color(0x050510);
                    
                    // Create camera
                    this.camera = new THREE.PerspectiveCamera(75, 
                        document.getElementById('gameContainer').offsetWidth / 
                        document.getElementById('gameContainer').offsetHeight, 
                        0.1, 1000);
                    this.camera.position.set(0, 5, 10);
                    
                    // Create renderer
                    const canvas = document.getElementById('gameCanvas');
                    this.renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
                    this.renderer.setSize(canvas.clientWidth, canvas.clientHeight);
                    this.renderer.shadowMap.enabled = true;
                    
                    // Add basic lighting
                    const ambientLight = new THREE.AmbientLight(0x333355);
                    this.scene.add(ambientLight);
                    
                    const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
                    directionalLight.position.set(10, 20, 5);
                    directionalLight.castShadow = true;
                    this.scene.add(directionalLight);
                    
                    // Create simple test scene
                    this.createTestScene();
                    
                    // Start animation loop
                    this.animate();
                    
                    addLog('Game engine initialized successfully', 'success');
                    return true;
                } catch (error) {
                    addLog(`Failed to initialize game: ${error.message}`, 'error');
                    return false;
                }
            }
            
            createTestScene() {
                // Create floor
                const floorGeometry = new THREE.PlaneGeometry(50, 50);
                const floorMaterial = new THREE.MeshStandardMaterial({ 
                    color: 0x222244,
                    metalness: 0.7,
                    roughness: 0.8
                });
                const floor = new THREE.Mesh(floorGeometry, floorMaterial);
                floor.rotation.x = -Math.PI / 2;
                floor.receiveShadow = true;
                this.scene.add(floor);
                
                // Create alien ship (simplified)
                const shipGeometry = new THREE.ConeGeometry(3, 8, 8);
                const shipMaterial = new THREE.MeshStandardMaterial({ 
                    color: 0xaa22ff,
                    emissive: 0x330066,
                    metalness: 0.8,
                    roughness: 0.3
                });
                const alienShip = new THREE.Mesh(shipGeometry, shipMaterial);
                alienShip.position.set(0, 4, 0);
                alienShip.rotation.x = Math.PI / 2;
                alienShip.castShadow = true;
                this.scene.add(alienShip);
                
                // Create some test consoles
                for (let i = 0; i < 4; i++) {
                    const consoleGeometry = new THREE.BoxGeometry(2, 1, 1);
                    const consoleMaterial = new THREE.MeshStandardMaterial({ 
                        color: 0x003322,
                        emissive: 0x002211
                    });
                    const console = new THREE.Mesh(consoleGeometry, consoleMaterial);
                    console.position.set(
                        (i - 1.5) * 6,
                        0.5,
                        10
                    );
                    console.castShadow = true;
                    this.scene.add(console);
                }
                
                // Create test aliens
                for (let i = 0; i < 3; i++) {
                    this.createTestAlien(i);
                }
            }
            
            createTestAlien(id) {
                const alienGeometry = new THREE.BoxGeometry(0.8, 2, 0.8);
                const alienMaterial = new THREE.MeshStandardMaterial({ 
                    color: 0x4a0066,
                    emissive: 0x220033
                });
                const alien = new THREE.Mesh(alienGeometry, alienMaterial);
                alien.position.set(
                    (Math.random() - 0.5) * 20,
                    1,
                    (Math.random() - 0.5) * 20
                );
                alien.castShadow = true;
                alien.userData = { id: id, type: 'alien' };
                this.scene.add(alien);
            }
            
            animate() {
                requestAnimationFrame(() => this.animate());
                
                // Rotate alien ship
                const alienShip = this.scene.children.find(child => 
                    child.geometry && child.geometry.type === 'ConeGeometry'
                );
                if (alienShip) {
                    alienShip.rotation.z += 0.01;
                }
                
                // Update FPS counter
                frameCount++;
                const currentTime = performance.now();
                if (currentTime >= lastTime + 1000) {
                    fps = Math.round((frameCount * 1000) / (currentTime - lastTime));
                    frameCount = 0;
                    lastTime = currentTime;
                    
                    document.getElementById('fpsCounter').textContent = fps;
                    document.getElementById('fpsCounter').className = fps < 30 ? 'check-fail' : 'check-pass';
                }
                
                // Update game time if started
                if (this.gameState.started) {
                    this.gameState.time += 0.016; // Approximate delta time
                }
                
                // Render scene
                const renderStart = performance.now();
                this.renderer.render(this.scene, this.camera);
                const renderEnd = performance.now();
                
                document.getElementById('renderTime').textContent = `${(renderEnd - renderStart).toFixed(2)}ms`;
            }
            
            startGame() {
                if (!this.gameState.started) {
                    this.gameState.started = true;
                    addLog('Game started successfully', 'success');
                    return true;
                }
                return false;
            }
            
            fireWeapon() {
                if (this.gameState.ammo > 0) {
                    this.gameState.ammo--;
                    
                    // Simulate hit
                    if (Math.random() > 0.4 && this.gameState.aliens > 0) {
                        this.gameState.aliens--;
                    }
                    
                    addLog(`Weapon fired. Ammo: ${this.gameState.ammo}/${this.gameState.maxAmmo}. Aliens: ${this.gameState.aliens}`, 'info');
                    return true;
                } else {
                    addLog('Out of ammo!', 'warning');
                    return false;
                }
            }
            
            reloadWeapon() {
                if (this.gameState.ammo < this.gameState.maxAmmo) {
                    this.gameState.ammo = this.gameState.maxAmmo;
                    addLog('Weapon reloaded', 'success');
                    return true;
                }
                return false;
            }
            
            toggleStealth() {
                this.gameState.stealth = !this.gameState.stealth;
                addLog(`Stealth ${this.gameState.stealth ? 'activated' : 'deactivated'}`, 'info');
                return this.gameState.stealth;
            }
            
            interact() {
                const actions = [
                    "Security system hacked",
                    "Navigation data downloaded", 
                    "Door opened",
                    "Console accessed",
                    "Alien device disabled"
                ];
                const action = actions[Math.floor(Math.random() * actions.length)];
                
                // Reduce distance to bridge
                this.gameState.distance = Math.max(10, this.gameState.distance - 15);
                
                addLog(`Interaction: ${action}. Distance to bridge: ${this.gameState.distance}m`, 'success');
                return action;
            }
            
            damagePlayer(amount = 20) {
                this.gameState.health = Math.max(0, this.gameState.health - amount);
                addLog(`Player damaged: -${amount} HP. Health: ${this.gameState.health}%`, 
                    this.gameState.health <= 30 ? 'warning' : 'info');
                return this.gameState.health;
            }
            
            healPlayer(amount = 30) {
                this.gameState.health = Math.min(100, this.gameState.health + amount);
                addLog(`Player healed: +${amount} HP. Health: ${this.gameState.health}%`, 'success');
                return this.gameState.health;
            }
            
            completeLevel() {
                if (this.gameState.level < 4) {
                    this.gameState.level++;
                    this.gameState.aliens = [12, 18, 24, 8][this.gameState.level - 1];
                    this.gameState.distance = [245, 180, 120, 40][this.gameState.level - 1];
                    
                    // Partial heal
                    this.gameState.health = Math.min(100, this.gameState.health + 25);
                    this.gameState.energy = Math.min(100, this.gameState.energy + 40);
                    
                    addLog(`Level ${this.gameState.level - 1} completed! Starting level ${this.gameState.level}`, 'success');
                    return this.gameState.level;
                } else {
                    addLog('All levels completed! Mission accomplished!', 'success');
                    return 'complete';
                }
            }
            
            addAlien() {
                this.gameState.aliens++;
                this.createTestAlien(this.gameState.aliens);
                addLog(`Alien added. Total: ${this.gameState.aliens}`, 'info');
                return this.gameState.aliens;
            }
            
            removeAlien() {
                if (this.gameState.aliens > 0) {
                    this.gameState.aliens--;
                    
                    // Remove from scene (simplified)
                    const aliens = this.scene.children.filter(child => 
                        child.userData && child.userData.type === 'alien'
                    );
                    if (aliens.length > 0) {
                        this.scene.remove(aliens[0]);
                    }
                    
                    addLog(`Alien removed. Total: ${this.gameState.aliens}`, 'info');
                    return this.gameState.aliens;
                }
                return 0;
            }
            
            getStatus() {
                return {
                    ...this.gameState,
                    fps: fps
                };
            }
        }
        
        // ============== TEST FUNCTIONS ==============
        function initializeGame() {
            if (!gameInstance) {
                gameInstance = new TestGame();
                addLog('Game instance created', 'success');
                
                // Setup event listeners for testing
                setupTestControls();
                
                // Start performance monitoring
                startPerformanceMonitor();
                
                return gameInstance;
            }
            return gameInstance;
        }
        
        function setupTestControls() {
            // Keyboard controls for testing
            document.addEventListener('keydown', (e) => {
                if (!gameInstance) return;
                
                switch(e.key.toLowerCase()) {
                    case 'e':
                        interactTest();
                        break;
                    case 'r':
                        reloadWeaponTest();
                        break;
                    case ' ':
                        fireWeaponTest();
                        break;
                    case 'shift':
                        toggleStealthTest();
                        break;
                }
            });
            
            // Mouse controls
            document.getElementById('gameCanvas').addEventListener('click', () => {
                addLog('Canvas clicked - mouse controls active', 'info');
            });
            
            addLog('Test controls initialized', 'success');
        }
        
        function startPerformanceMonitor() {
            setInterval(() => {
                if (gameInstance) {
                    const status = gameInstance.getStatus();
                    
                    // Update UI with game state
                    updateStatusDisplay(status);
                    
                    // Check memory (simulated)
                    if (performance.memory) {
                        const usedMB = Math.round(performance.memory.usedJSHeapSize / 1048576);
                        const totalMB = Math.round(performance.memory.totalJSHeapSize / 1048576);
                        document.getElementById('memoryCounter').textContent = `${usedMB}/${totalMB} MB`;
                        document.getElementById('memoryCounter').className = 
                            usedMB > totalMB * 0.8 ? 'check-fail' : 'check-pass';
                    }
                }
            }, 1000);
        }
        
        function updateStatusDisplay(status) {
            // Create or update status overlay
            let overlay = document.getElementById('gameOverlay');
            if (!overlay) {
                overlay = document.createElement('div');
                overlay.id = 'gameOverlay';
                overlay.style.cssText = `
                    position: absolute;
                    top: 20px;
                    left: 20px;
                    background: rgba(0, 0, 0, 0.7);
                    color: white;
                    padding: 15px;
                    border-radius: 8px;
                    font-family: monospace;
                    font-size: 14px;
                    pointer-events: none;
                    z-index: 100;
                `;
                document.getElementById('gameContainer').appendChild(overlay);
            }
            
            overlay.innerHTML = `
                <div style="margin-bottom: 5px;"><strong>TEST MODE ACTIVE</strong></div>
                <div>Level: ${status.level}</div>
                <div>Health: ${status.health}%</div>
                <div>Energy: ${status.energy}%</div>
                <div>Aliens: ${status.aliens}</div>
                <div>Distance: ${status.distance}m</div>
                <div>Ammo: ${status.ammo}/${status.maxAmmo}</div>
                <div>Stealth: ${status.stealth ? 'ON' : 'OFF'}</div>
                <div>FPS: ${status.fps}</div>
            `;
        }
        
        // Test functions
        function startGameTest() {
            if (!gameInstance) {
                gameInstance = initializeGame();
            }
            
            if (gameInstance.startGame()) {
                addLog('Game start test: PASSED', 'success');
            } else {
                addLog('Game start test: FAILED (already started)', 'warning');
            }
        }
        
        function fireWeaponTest() {
            if (!gameInstance) {
                addLog('Game not initialized. Click START GAME first.', 'error');
                return;
            }
            
            if (gameInstance.fireWeapon()) {
                addLog('Weapon fire test: PASSED', 'success');
            } else {
                addLog('Weapon fire test: FAILED (out of ammo)', 'warning');
            }
        }
        
        function reloadWeaponTest() {
            if (!gameInstance) {
                addLog('Game not initialized. Click START GAME first.', 'error');
                return;
            }
            
            if (gameInstance.reloadWeapon()) {
                addLog('Reload test: PASSED', 'success');
            } else {
                addLog('Reload test: ALREADY FULL', 'info');
            }
        }
        
        function toggleStealthTest() {
            if (!gameInstance) {
                addLog('Game not initialized. Click START GAME first.', 'error');
                return;
            }
            
            const newState = gameInstance.toggleStealth();
            addLog(`Stealth toggle test: ${newState ? 'STEALTH ON' : 'STEALTH OFF'}`, 'success');
        }
        
        function interactTest() {
            if (!gameInstance) {
                addLog('Game not initialized. Click START GAME first.', 'error');
                return;
            }
            
            const result = gameInstance.interact();
            addLog(`Interaction test: ${result}`, 'success');
        }
        
        function damagePlayerTest() {
            if (!gameInstance) {
                addLog('Game not initialized. Click START GAME first.', 'error');
                return;
            }
            
            const health = gameInstance.damagePlayer(20);
            addLog(`Damage test: Player health now ${health}%`, 
                health <= 30 ? 'warning' : 'success');
        }
        
        function healPlayerTest() {
            if (!gameInstance) {
                addLog('Game not initialized. Click START GAME first.', 'error');
                return;
            }
            
            const health = gameInstance.healPlayer(30);
            addLog(`Heal test: Player health now ${health}%`, 'success');
        }
        
        function simulateCombatTest() {
            if (!gameInstance) {
                addLog('Game not initialized. Click START GAME first.', 'error');
                return;
            }
            
            addLog('=== COMBAT SIMULATION START ===', 'warning');
            
            // Simulate combat sequence
            gameInstance.fireWeapon();
            gameInstance.fireWeapon();
            gameInstance.damagePlayer(15);
            gameInstance.reloadWeapon();
            gameInstance.fireWeapon();
            
            addLog('=== COMBAT SIMULATION COMPLETE ===', 'success');
        }
        
        function completeLevelTest() {
            if (!gameInstance) {
                addLog('Game not initialized. Click START GAME first.', 'error');
                return;
            }
            
            const result = gameInstance.completeLevel();
            if (result === 'complete') {
                addLog('LEVEL COMPLETE TEST: MISSION ACCOMPLISHED!', 'success');
            } else {
                addLog(`Level complete test: Now on level ${result}`, 'success');
            }
        }
        
        function addAlienTest() {
            if (!gameInstance) {
                addLog('Game not initialized. Click START GAME first.', 'error');
                return;
            }
            
            const count = gameInstance.addAlien();
            addLog(`Add alien test: ${count} aliens total`, 'success');
        }
        
        function removeAlienTest() {
            if (!gameInstance) {
                addLog('Game not initialized. Click START GAME first.', 'error');
                return;
            }
            
            const count = gameInstance.removeAlien();
            addLog(`Remove alien test: ${count} aliens remaining`, 'success');
        }
        
        function nextLevelTest() {
            completeLevelTest();
        }
        
        function failMissionTest() {
            if (!gameInstance) {
                addLog('Game not initialized. Click START GAME first.', 'error');
                return;
            }
            
            gameInstance.damagePlayer(100);
            addLog('MISSION FAILED TEST: Player eliminated', 'error');
        }
        
        function resetGameTest() {
            gameInstance = null;
            
            // Clear canvas
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Remove overlay
            const overlay = document.getElementById('gameOverlay');
            if (overlay) overlay.remove();
            
            // Reset Three.js
            if (window.THREE) {
                // Clean up Three.js resources if needed
            }
            
            addLog('Game reset complete. Click START GAME to begin new test.', 'warning');
        }
        
        // ============== BROWSER COMPATIBILITY CHECK ==============
        function checkBrowserCompatibility() {
            addLog('Checking browser compatibility...', 'info');
            
            const checks = {
                'WebGL': () => {
                    try {
                        const canvas = document.createElement('canvas');
                        return !!(window.WebGLRenderingContext && 
                                 (canvas.getContext('webgl') || canvas.getContext('experimental-webgl')));
                    } catch (e) {
                        return false;
                    }
                },
                'Three.js': () => typeof THREE !== 'undefined',
                'Canvas': () => {
                    const canvas = document.createElement('canvas');
                    return !!(canvas.getContext && canvas.getContext('2d'));
                },
                'JavaScript': () => {
                    try {
                        return !!(window.Promise && window.Map && window.Set && window.Array.from);
                    } catch (e) {
                        return false;
